<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>–í–∞—à–∞ –≥–∞–ª–µ—Ä–µ—è</title>
  <link rel="stylesheet" href="style.css" />
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/FileSaver.js/2.0.5/FileSaver.min.js"></script>
  <style>
    body {
      margin: 0;
      padding: 0;
      font-family: sans-serif;
      background-color: #f9f9f9;
    }

    .notice-bar {
      background-color: #201c1c;
      color: #999;
      height: 30px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 14px;
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      z-index: 1000;
    }

    .notice-bar strong {
      color: white;
      font-weight: 500;
    }

    .topbar {
      height: 45px;
      background: white;
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 0 35px;
      box-sizing: border-box;
      box-shadow: 0 1px 4px rgba(0, 0, 0, 0.1);
    }

    .topbar.fixed {
      position: fixed;
      top: 30px;
      left: 0;
      width: 100%;
      z-index: 999;
      display: none;
    }

    .topbar.static {
      position: relative;
      z-index: 1;
    }

    .topbar .left {
      font-size: 16px;
      color: #333;
      font-weight: 500;
    }

    .topbar .right img {
      height: 25px;
      cursor: pointer;
    }

    .highlight-box {
      position: relative;
      width: 100%;
      height: 100vh;
      max-height: 1080px;
      overflow: hidden;
      margin-bottom: 20px;
    }

    .highlight-box img {
      width: 100%;
      height: 100%;
      object-fit: cover;
      filter: brightness(60%);
    }

    .overlay-text {
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      color: white;
      text-align: center;
    }

    .overlay-text h1 {
      font-size: 32px;
      margin: 0;
    }

    .overlay-text p {
      font-size: 16px;
      margin: 10px 0 0;
    }

    #photo-container {
      column-count: 4;       /* 4 –∫–æ–ª–æ–Ω–∫–∏ –Ω–∞ –¥–µ—Å–∫—Ç–æ–ø–µ */
      column-gap: 12px;      /* —Ä–∞—Å—Å—Ç–æ—è–Ω–∏–µ –º–µ–∂–¥—É –∫–æ–ª–æ–Ω–∫–∞–º–∏ */
      padding: 0 35px;
      grid-template-columns: repeat(4, 1fr); /* —Å—Ç—Ä–æ–≥–æ 4 –∫–æ–ª–æ–Ω–∫–∏ –Ω–∞ –¥–µ—Å–∫—Ç–æ–ø–µ */
      gap: 12px;
      padding: 0 35px;
    }

    .photo-box {
      display: inline-block; /* —á—Ç–æ–±—ã –º–æ–∂–Ω–æ –±—ã–ª–æ –≤ –∫–æ–ª–æ–Ω–∫—É */
      width: 100%;           /* —Ä–∞—Å—Ç—è–≥–∏–≤–∞–µ—Ç—Å—è –ø–æ —à–∏—Ä–∏–Ω–µ –∫–æ–ª–æ–Ω–∫–∏ */
      margin-bottom: 12px;   /* –æ—Ç—Å—Ç—É–ø –º–µ–∂–¥—É —Ñ–æ—Ç–∫–∞–º–∏ */
      border-radius: 10px;
      overflow: hidden;
      box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
      break-inside: avoid;   /* —á—Ç–æ–±—ã –Ω–µ —Ä–≤–∞–ª–æ –±–ª–æ–∫–∏ */
    }

    .photo-box img {
      width: 100%;
      height: auto;
      display: block;
      border-radius: 10px;
      cursor: zoom-in;
    }

    .download-button {
      position: absolute;
      bottom: 8px;
      right: 8px;
      width: 28px;
      height: 28px;
      background-color: rgba(0, 0, 0, 0.6);
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      opacity: 0;
      transition: opacity 0.3s ease;
      text-decoration: none;
    }

    .download-button img {
      width: 16px;
      height: 16px;
      filter: invert(1);
    }

    .photo-box:hover .download-button {
      opacity: 1;
    }
    .lightbox-download {
      margin-top: 8px; /* —á—É—Ç—å –Ω–∏–∂–µ –∫–∞—Ä—Ç–∏–Ω–∫–∏ */
      background: rgba(255, 255, 255, 0.2);
      padding: 6px;
      border-radius: 50%;
      z-index: 20;
      display: inline-flex;  /* –º–∞–ª–µ–Ω—å–∫–∏–π –∫—Ä—É–∂–æ–∫ */
      align-items: center;
      justify-content: center;
      width: 36px;           /* –Ω–µ–±–æ–ª—å—à–æ–π —Ä–∞–∑–º–µ—Ä */
      height: 36px;
    }


    .lightbox-download img {
      width: 24px;
      height: 24px;
      filter: invert(1);
    }

    .hint-overlay {
      position: fixed;
      inset: 0;
      background: rgba(0, 0, 0, 0.6);
      pointer-events: none;
      z-index: 2000;
      display: none;
      clip-path: circle(80px at var(--x, 50%) var(--y, 50%));
      transition: opacity 0.3s ease;
    }

    .hint-text {
      position: fixed;
      color: white;
      font-size: 16px;
      font-weight: 500;
      background: rgba(0,0,0,0.5);
      padding: 6px 12px;
      border-radius: 8px;
      z-index: 2001;
      pointer-events: none;
      transform: translate(-50%, -50%);
      display: none;
    }


    .modal-overlay {
      position: fixed;
      inset: 0;
      background: rgba(0,0,0,0.5);
      display: none;
      align-items: center;
      justify-content: center;
      z-index: 3000;
    }

    .modal-content {
      background: white;
      border-radius: 20px;
      padding: 25px 15px;
      text-align: center;
      width: 100%;
      max-width: 480px;
      position: relative;
      box-shadow: 0 10px 30px rgba(0,0,0,0.3);
      animation: fadeIn 0.7s ease;
      display: flex;
      flex-direction: column;
      align-items: center; /* —Ü–µ–Ω—Ç—Ä–∏—Ä—É–µ–º –∫–æ–Ω—Ç–µ–Ω—Ç –ø–æ –≥–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª–∏ */
    }

    .modal-content img {
      width: 450px;
      height: 450px;
      object-fit: cover;
      border-radius: 16px;
      margin-bottom: 16px;
    }



    .modal-content p {
      margin: 0;
      font-size: 16px;
      color: #333;
      font-weight: 500;
    }

    .modal-close {
      position: absolute;
      top: 6px;
      right: 8px;
      background: transparent;
      border: none;
      font-size: 22px;
      color: #999;
      cursor: pointer;
    }

    .modal-close:hover {
      color: #444;
    }

    @keyframes fadeIn {
      from { transform: scale(0.95); opacity: 0; }
      to { transform: scale(1); opacity: 1; }
    }


    @media (max-width: 768px) {
      .modal-content {
        max-width: calc(100% - 40px); /* –ø–æ 20px –æ—Ç—Å—Ç—É–ø–∞ —Å–ª–µ–≤–∞ –∏ —Å–ø—Ä–∞–≤–∞ */
        padding: 20px 15px;
      }

      .modal-content img {
        width: 100%;
        height: auto;
        max-height: 300px;
        object-fit: contain;
      }

      .modal-content p {
        font-size: 15px;
      }
}
        .mode-buttons {
      display: flex;
      justify-content: center;
      gap: 12px;
      margin: 30px 0;
    }

    .mode-btn {
      background-color: white;
      color: #201c1c;
      border: 1px solid rgba(0, 0, 0, 0.08);
      padding: 10px 20px;
      border-radius: 30px;
      font-size: 14px;
      font-weight: 500;
      cursor: pointer;
      box-shadow: 0 1px 4px rgba(0, 0, 0, 0.08);
      transition: all 0.2s ease-in-out;
    }

    .mode-btn:hover {
      background-color: #f3f3f3;
      box-shadow: 0 2px 6px rgba(0, 0, 0, 0.12);
    }

    .mode-btn.active-mode {
      background-color: #ececec;
      font-weight: 600;
    }





    @media (max-width: 768px) {
      .lightbox-download {
        top: 15px;    /* –ø–æ–¥–Ω–∏–º–µ–º –≤—ã—à–µ */
        bottom: auto; /* –æ—Ç–∫–ª—é—á–∞–µ–º –Ω–∏–∂–Ω—é—é –ø—Ä–∏–≤—è–∑–∫—É */
        right: 15px;
        width: 56px;   /* —á—É—Ç—å –±–æ–ª—å—à–µ –¥–ª—è –ø–∞–ª—å—Ü–∞ */
        height: 56px;
        padding: 12px;
      }
    }


    /* üì± –ê–¥–∞–ø—Ç–∏–≤–Ω—ã–µ —Å—Ç–∏–ª–∏ –¥–ª—è —Ç–µ–ª–µ—Ñ–æ–Ω–æ–≤ */
    @media (max-width: 768px) {
      .highlight-box {
        height: 60vh;
        max-height: none;
      }

      .overlay-text h1 {
        font-size: 24px;
      }

      .overlay-text p {
        font-size: 14px;
      }

      #photo-container {
        column-count: 2;     /* 2 –∫–æ–ª–æ–Ω–∫–∏ –Ω–∞ —Ç–µ–ª–µ—Ñ–æ–Ω–µ */
      padding: 0 5px;

      }

      .topbar {
        padding: 0 16px;
      }

      .topbar .left {
        font-size: 14px;
      }

      .topbar .right img {
        height: 25px;
        vertical-align: middle;
        cursor: pointer;
      }

      .notice-bar {
        font-size: 12px;
      }
    }


    /* üåå Lightbox */
    #lightbox {
      position: fixed;
      z-index: 2000;
      top: 0; left: 0; right: 0; bottom: 0;
      display: none;
    }

    .lightbox-backdrop {
      background: rgba(0, 0, 0, 0.85);
      position: absolute;
      top: 0; left: 0; right: 0; bottom: 0;
    }

    .lightbox-content {
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      max-width: 90vw;
      max-height: 90vh;
      display: flex;
      flex-direction: column; /* –∫–∞—Ä—Ç–∏–Ω–∫–∞ —Å–≤–µ—Ä—Ö—É, –∫–Ω–æ–ø–∫–∞ —Å–Ω–∏–∑—É */
      align-items: flex-end;  /* –∫–Ω–æ–ø–∫–∞ –ø—Ä–∏–∂–∞—Ç–∞ –∫ –ø—Ä–∞–≤–æ–º—É –∫—Ä–∞—é */
      justify-content: center;
    }

    .lightbox-content img {
      max-width: 100%;
      max-height: 100%;
      border-radius: 10px;
      transition: transform 0.2s ease;
      cursor: zoom-in;
    }

    .lightbox-close {
      position: absolute;
      top: 20px;
      right: 30px;
      font-size: 32px;
      color: white;
      background: none;
      border: none;
      cursor: pointer;
    }

    .lightbox-arrow {
      position: absolute;
      top: 50%;
      transform: translateY(-50%);
      background: rgba(255,255,255,0.2);
      border: none;
      cursor: pointer;
      padding: 10px;
      border-radius: 50%;
    }

    .lightbox-arrow.left {
      left: 20px;
    }

    .lightbox-arrow.right {
      right: 20px;
    }

    .lightbox-arrow img {
      width: 24px;
      height: 24px;
      filter: invert(1);
    }

    @media (max-width: 768px) {
      .lightbox-content {
        top: 0;
        left: 0;
        transform: none;
        width: 100vw;
        height: 100vh;
        max-width: none;
        max-height: none;
        border-radius: 0;
        flex-direction: column; /* –∫–∞—Ä—Ç–∏–Ω–∫–∞ —Å–≤–µ—Ä—Ö—É, –∫–Ω–æ–ø–∫–∞ —Å–Ω–∏–∑—É */
        align-items: flex-end;  /* –∫–Ω–æ–ø–∫–∞ —Å–ø—Ä–∞–≤–∞ */
      }

      .lightbox-content img {
        width: 100%;
        height: auto;
        object-fit: contain;
      }
      .lightbox-download {
        margin-top: 6px;
        width: 31px;
        height: 31px;
        padding: 10px;
      }
    }

    .loading-overlay {
      position: fixed;
      inset: 0;
      background: rgba(0,0,0,0.5);
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 9999;
    }

    /* –ø—Ä—è–º–æ—É–≥–æ–ª—å–Ω–∏–∫ –ø–æ —Ü–µ–Ω—Ç—Ä—É */
    .loading-box {
      background: #fff;
      color: #000;
      padding: 20px 40px;
      border-radius: 8px;
      font-size: 18px;
      font-weight: 500;
      box-shadow: 0 4px 12px rgba(0,0,0,0.3);

      display: flex;           /* –Ω–æ–≤–æ–µ */
      flex-direction: column;  /* –Ω–æ–≤–æ–µ */
      gap: 8px;                /* –Ω–æ–≤–æ–µ: —Ä–∞—Å—Å—Ç–æ—è–Ω–∏–µ –º–µ–∂–¥—É —Å—Ç—Ä–æ–∫–∞–º–∏ */
      min-width: 260px;        /* –º–æ–∂–Ω–æ —Ä–∞—Å—à–∏—Ä–∏—Ç—å */
      min-height: 100px;       /* –º–æ–∂–Ω–æ —Ä–∞—Å—à–∏—Ä–∏—Ç—å */
      text-align: center;      /* –∫—Ä–∞—Å–∏–≤–æ */
    }

    /* –∏–∑–Ω–∞—á–∞–ª—å–Ω–æ —Å–∫—Ä—ã—Ç—å */
    #loadingOverlay.hidden {
      display: none;
    }

  </style>
</head>
<body>


  <div class="notice-bar">–§–æ—Ç–æ–≥—Ä–∞—Ñ–∏–∏ –¥–æ—Å—Ç—É–ø–Ω—ã –¥–æ <strong> 01.12.2025</strong></div>

  <div class="highlight-box">
    <img id="cover-image" src="" alt="–û–±–ª–æ–∂–∫–∞" />
    <div class="overlay-text">
      <h1 id="session-title">...</h1>
      <p id="session-date">...</p>
    </div>
  </div>

  <div class="topbar fixed" id="fixedTopbar">
    <div class="left">Kovalev Nazar</div>
    <div class="right"><img id="download-all-btn-fixed" src="img/download.svg" alt="–°–∫–∞—á–∞—Ç—å" /></div>
  </div>

  <div id="loadingOverlay" class="loading-overlay hidden">
    <div class="loading-box">
      <p id="loadingText">–ò–¥—ë—Ç –∑–∞–≥—Ä—É–∑–∫–∞</p>
      <p id="loadingProgress"></p> <!-- —Å—é–¥–∞ –≤—ã–≤–æ–¥–∏–º –ø—Ä–æ–≥—Ä–µ—Å—Å -->
    </div>
  </div>





  <div class="topbar static" id="staticTopbar">
    <div class="left">Kovalev Nazar</div>
    <div class="right"><img id="download-all-btn-static" src="img/download.svg" alt="–°–∫–∞—á–∞—Ç—å" /></div>
  </div>

  <div id="modeButtons" class="mode-buttons" style="display: none;">
    <button class="mode-btn" data-mode="original">–û—Ä–∏–≥–∏–Ω–∞–ª</button>
    <button class="mode-btn" data-mode="filtered">–° —Ñ–∏–ª—å—Ç—Ä–æ–º</button>
    <button class="mode-btn" data-mode="vintage">–í–∏–Ω—Ç–∞–∂</button>
  </div>

  <div id="photo-container"></div>

  <!-- Lightbox -->
  <div id="lightbox">
    <div class="lightbox-backdrop" id="lightboxBackdrop"></div>
    <div class="lightbox-content">
      <img id="lightboxImage" src="" alt="–§–æ—Ç–æ" />
      <button class="lightbox-close" id="lightboxClose">√ó</button>
      <button class="lightbox-arrow left" id="prevBtn"><img src="img/left.svg" alt="–ù–∞–∑–∞–¥"></button>
      <button class="lightbox-arrow right" id="nextBtn"><img src="img/right.svg" alt="–í–ø–µ—Ä—ë–¥"></button>
      <a id="lightboxDownload" class="lightbox-download" download>
        <img src="img/download.svg" alt="–°–∫–∞—á–∞—Ç—å">
      </a>
    </div>
  </div>


    <div id="thanksModal" class="modal-overlay">
      <div class="modal-content">
        <button class="modal-close" id="modalCloseBtn">√ó</button>
        <img src="img/kittie1.jpg" alt="–ö–æ—Ç–∏–∫" />
        <p><b> >—Å–ø–∞—Å–∏–±–æ –∑–∞ —Ñ–æ—Ç–æ—Å–µ—Å—Å–∏—é! </b> <br> —Å–µ–π—á–∞—Å –Ω–∞—á–Ω–µ—Ç—Å—è –∑–∞–≥—Ä—É–∑–∫–∞..</p>
      </div>
    </div>



  <script>
    let allPhotoUrls = [];
    let currentIndex = 0;
    let zoomed = false;

    async function downloadAllPhotos() {
      if (allPhotoUrls.length === 0) {
        alert("–§–æ—Ç–æ–≥—Ä–∞—Ñ–∏–∏ –µ—â—ë –Ω–µ –∑–∞–≥—Ä—É–∂–µ–Ω—ã.");
        return;
      }
      // –ü–æ–∫–∞–∑–∞—Ç—å –æ–∫–Ω–æ —Å –∫–æ—Ç–∏–∫–æ–º
      const modal = document.getElementById("thanksModal");
      modal.style.display = "flex";



      const zip = new JSZip();
      const promises = allPhotoUrls.map(async (url, index) => {
        try {
          const response = await fetch(url);
          const blob = await response.blob();
          const contentType = response.headers.get("Content-Type");
          let ext = contentType.includes("jpeg") ? "jpg" :
                    contentType.includes("png") ? "png" :
                    contentType.includes("webp") ? "webp" : "jpg";
          const fileName = `photo_${String(index + 1).padStart(3, '0')}.${ext}`;
          zip.file(fileName, blob);
        } catch (e) {
          console.error(`–û—à–∏–±–∫–∞ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ ${url}`, e);
        }
      });

      await Promise.all(promises);
      const content = await zip.generateAsync({ type: "blob" });
      saveAs(content, "gallery.zip");
    }

    function showLightbox(index) {
      if (!allPhotoUrls[index]) return;
      currentIndex = index;
      zoomed = false;

      // –û–±–Ω–æ–≤–ª—è–µ–º href + download —Å—Ä–∞–∑—É
      const url = allPhotoUrls[index];
      const downloadBtn = document.getElementById("lightboxDownload");
      downloadBtn.href = url;

      // –í—ã—Ç–∞—â–∏–º –∏–º—è —Ñ–∞–π–ª–∞ –∏–∑ URL (–∏–ª–∏ –¥–∞–¥–∏–º —Å–≤–æ—ë)
      const filename = url.split('/').pop() || `photo_${index + 1}.jpg`;
      downloadBtn.setAttribute("download", filename);

      const lightboxImage = document.getElementById("lightboxImage");
      lightboxImage.src = url;
      lightboxImage.style.transform = "scale(1)";
      document.getElementById("lightbox").style.display = "block";
    }

    function closeLightbox() {
      document.getElementById("lightbox").style.display = "none";
    }

    function nextImage() {
      currentIndex = (currentIndex + 1) % allPhotoUrls.length;
      showLightbox(currentIndex);
    }

    function prevImage() {
      currentIndex = (currentIndex - 1 + allPhotoUrls.length) % allPhotoUrls.length;
      showLightbox(currentIndex);
    }

    let loadingInterval;
    function startLoadingAnimation() {
      const loadingText = document.getElementById("loadingText");
      let dotCount = 0;
      loadingInterval = setInterval(() => {
        dotCount = (dotCount + 1) % 4; // 0‚Äì3 —Ç–æ—á–∫–∏
        loadingText.textContent = "–ò–¥—ë—Ç –∑–∞–≥—Ä—É–∑–∫–∞" + ".".repeat(dotCount);
      }, 500);
    }

    function stopLoadingAnimation() {
      clearInterval(loadingInterval);
      const loadingText = document.getElementById("loadingText");
      if (loadingText) loadingText.textContent = "–ò–¥—ë—Ç –∑–∞–≥—Ä—É–∑–∫–∞";
    }


    window.addEventListener('load', () => {
      const params = new URLSearchParams(window.location.search);
      const code = params.get("code");
      const container = document.getElementById("photo-container");
      const key = params.get("code");
      const validKeys = {
        // –ü–µ—Ä–≤—ã–π –∞–ª—å–±–æ–º
        avecfplcluttyikwkenfrcske: "original",
        icdluhxislzhofnugbfhtvkac: "filtered",
        ucnshzwbskeujgrdazmxcgwbn: "vintage",
        // –í—Ç–æ—Ä–æ–π –∞–ª—å–±–æ–º
        txllntcechyxfqheyncxvhase: "original",
        axxsxwmtuspvpaozqqwjqrmsn: "filtered",
        waqzhgeguhkgbwixgzfeuosqk: "vintage"
      };

      if (key in validKeys) {
        document.getElementById("modeButtons").style.display = "flex";

        // –ê–∫—Ç–∏–≤–Ω–∞—è –∫–Ω–æ–ø–∫–∞
        const mode = validKeys[key];
        document.querySelectorAll('.mode-btn').forEach(btn => {
          if (btn.dataset.mode === mode) {
            btn.classList.add("active-mode");
          }
        });
      }

      document.getElementById("modalCloseBtn").addEventListener("click", () => {
      document.getElementById("thanksModal").style.display = "none";
      });

      if (!code) {
        container.innerHTML = "<p>–ö–æ–¥ –¥–æ—Å—Ç—É–ø–∞ –Ω–µ —É–∫–∞–∑–∞–Ω.</p>";
        return;
      }

 fetch(`/api/photos/${code}`)
  .then(res => res.json())
  .then(data => {
    if (!data.success) {
      container.innerHTML = "<p>No photos found for this code.</p>";
      return;
    }

    // –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –æ–≤–µ—Ä–ª–µ–π –∑–∞–≥—Ä—É–∑–∫–∏
    const overlay = document.getElementById("loadingOverlay");
    overlay?.classList.remove("hidden"); // hidden = display:none –≤ CSS
    startLoadingAnimation();

    // –∑–∞–ø–æ–ª–Ω—è–µ–º –∑–∞–≥–æ–ª–æ–≤–æ–∫, –æ–±–ª–æ–∂–∫—É, –¥–∞—Ç—É
    document.getElementById("cover-image").src = data.cover || "";
    document.getElementById("session-title").textContent = data.title || "Photoshoot";
    document.getElementById("session-date").textContent = data.date || "";

    // –§—É–Ω–∫—Ü–∏—è –∏–∑–≤–ª–µ—á–µ–Ω–∏—è —Ä–µ–π—Ç–∏–Ω–≥–∞ –∏–∑ –∏–º–µ–Ω–∏ —Ñ–∞–π–ª–∞
    function extractRating(url) {
      const match = url.match(/\/(\d)[^\/]*\.(jpg|jpeg|png|webp)/i);
      return match ? parseInt(match[1], 10) : 0;
    }
    allPhotoUrls = data.urls.sort((a, b) => extractRating(b) - extractRating(a)); // <‚Äî —ç—Ç–æ–π —Å—Ç—Ä–æ–∫–∏ —É —Ç–µ–±—è —Å–µ–π—á–∞—Å –Ω–µ—Ç

    // –°–æ—Ä—Ç–∏—Ä—É–µ–º –ø–æ —É–±—ã–≤–∞–Ω–∏—é —Ä–µ–π—Ç–∏–Ω–≥–∞
    container.innerHTML = ""; // –æ—á–∏—â–∞–µ–º –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä

    let loadedCount = 0;
    const total = allPhotoUrls.length;

    // ‚úÖ —Å–æ–∑–¥–∞—ë–º –±–ª–æ–∫–∏ –¥–ª—è –∫–∞–∂–¥–æ–π —Ñ–æ—Ç–∫–∏
    allPhotoUrls.forEach((url, index) => {
      const box = document.createElement("div");
      box.className = "photo-box";

      const img = document.createElement("img");
      img.src = url;
      img.alt = "Photo";

      img.addEventListener("load", () => {
        loadedCount++;
        const progressEl = document.getElementById("loadingProgress");
        if (progressEl) {
          progressEl.textContent = `–ó–∞–≥—Ä—É–∂–µ–Ω–æ ${loadedCount} –∏–∑ ${total}‚Ä¶`;
        }
        if (loadedCount === total && overlay) {
          stopLoadingAnimation();
          overlay.classList.add("hidden");
        }
      });

      img.addEventListener("click", () => showLightbox(index));

      const download = document.createElement("a");
      download.href = url;
      download.download = "";
      download.className = "download-button";

      const icon = document.createElement("img");
      icon.src = "img/download.svg";
      icon.alt = "Download";
      download.appendChild(icon);

      box.appendChild(img);
      box.appendChild(download);
      container.appendChild(box);
    });

  });



      const sentinel = document.createElement('div');
      sentinel.style.height = '1px';
      document.getElementById('staticTopbar').before(sentinel);
      let observerStarted = false;

      window.addEventListener('scroll', () => {
        if (!observerStarted && window.scrollY >= 300) {
          observerStarted = true;
          const observer = new IntersectionObserver(([entry]) => {
            document.getElementById('fixedTopbar').style.display = entry.isIntersecting ? 'none' : 'flex';
          }, { rootMargin: "-30px 0px 0px 0px" });
          observer.observe(sentinel);
        }
      });

      document.getElementById('download-all-btn-static').addEventListener('click', downloadAllPhotos);
      document.getElementById('download-all-btn-fixed').addEventListener('click', downloadAllPhotos);
      document.getElementById("lightboxClose").addEventListener("click", closeLightbox);
      document.getElementById("lightboxBackdrop").addEventListener("click", closeLightbox);
      document.getElementById("nextBtn").addEventListener("click", nextImage);
      document.getElementById("prevBtn").addEventListener("click", prevImage);
      document.addEventListener("keydown", e => {
        if (document.getElementById("lightbox").style.display === "block") {
          if (e.key === "ArrowRight") nextImage();
          if (e.key === "ArrowLeft") prevImage();
          if (e.key === "Escape") closeLightbox();
        }
      });
        
        document.getElementById("lightboxDownload").addEventListener("click", async (e) => {
          e.preventDefault();
          const url = allPhotoUrls[currentIndex];
          const response = await fetch(url);
          const blob = await response.blob();
          const link = document.createElement("a");
          link.href = URL.createObjectURL(blob);
          link.download = url.split('/').pop() || `photo_${currentIndex + 1}.jpg`;
          document.body.appendChild(link);
          link.click();
          link.remove();
          URL.revokeObjectURL(link.href);

      });


      // –û–±—Ä–∞–±–æ—Ç–∫–∞ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏—è —Ä–µ–∂–∏–º–æ–≤
      document.querySelectorAll(".mode-btn").forEach(btn => {
        btn.addEventListener("click", () => {
          // –ì—Ä—É–ø–ø–∏—Ä–æ–≤–∫–∞ –∫–ª—é—á–µ–π –ø–æ –∞–ª—å–±–æ–º–∞–º
          const keyGroups = {
            // –ê–ª—å–±–æ–º 1
            avecfplcluttyikwkenfrcske: "group1",
            icdluhxislzhofnugbfhtvkac: "group1",
            ucnshzwbskeujgrdazmxcgwbn: "group1",
            // –ê–ª—å–±–æ–º 2
            txllntcechyxfqheyncxvhase: "group2",
            axxsxwmtuspvpaozqqwjqrmsn: "group2",
            waqzhgeguhkgbwixgzfeuosqk: "group2"
          };

          // –ù–∞–±–æ—Ä –∫–ª—é—á–µ–π –ø–æ –≥—Ä—É–ø–ø–∞–º
          const keySets = {
            group1: {
              original: "avecfplcluttyikwkenfrcske",
              filtered: "icdluhxislzhofnugbfhtvkac",
              vintage: "ucnshzwbskeujgrdazmxcgwbn"
            },
            group2: {
              original: "txllntcechyxfqheyncxvhase",
              filtered: "axxsxwmtuspvpaozqqwjqrmsn",
              vintage: "waqzhgeguhkgbwixgzfeuosqk"
            }
          };

          // –û–ø—Ä–µ–¥–µ–ª—è–µ–º –≥—Ä—É–ø–ø—É –ø–æ —Ç–µ–∫—É—â–µ–º—É –∫–ª—é—á—É
          const currentGroup = keyGroups[code];

          // –û–±—Ä–∞–±–æ—Ç–∫–∞ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏—è —Ä–µ–∂–∏–º–æ–≤ —Å —É—á—ë—Ç–æ–º –≥—Ä—É–ø–ø—ã
          document.querySelectorAll(".mode-btn").forEach(btn => {
            btn.addEventListener("click", () => {
              const mode = btn.dataset.mode;
              const codeMap = keySets[currentGroup];
              if (codeMap && codeMap[mode]) {
                window.location.href = `${window.location.pathname}?code=${codeMap[mode]}`;
              }
            });
          });

        });
      });


      document.getElementById("lightboxImage").addEventListener("click", () => {
        
        const img = document.getElementById("lightboxImage");
        zoomed = !zoomed;
        img.style.transform = zoomed ? "scale(2.5)" : "scale(1)";
        img.style.cursor = zoomed ? "zoom-out" : "zoom-in";
      });
    });

    const lightboxImage = document.getElementById("lightboxImage");

    lightboxImage.addEventListener("mousemove", (e) => {
      if (window.innerWidth <= 768) return; // –¢–æ–ª—å–∫–æ –Ω–∞ –ü–ö
      const rect = lightboxImage.getBoundingClientRect();
      const x = ((e.clientX - rect.left) / rect.width) * 100;
      const y = ((e.clientY - rect.top) / rect.height) * 100;
      lightboxImage.style.transformOrigin = `${x}% ${y}%`;
      if (zoomed) {
        lightboxImage.style.transform = "scale(2.5)";
      }
    });

    lightboxImage.addEventListener("mouseleave", () => {
      if (window.innerWidth <= 768) return;
      if (zoomed) {
        lightboxImage.style.transform = "scale(2.5)";
      } else {
        lightboxImage.style.transform = "scale(1)";
      }
    });

    let hintShown = false;

    window.addEventListener('scroll', () => {
      if (!hintShown && window.scrollY > 500) {
        hintShown = true;

        const overlay = document.getElementById('downloadHintOverlay');
        const hintText = document.getElementById('hintText');
        const btn = document.getElementById('download-all-btn-fixed');

        const rect = btn.getBoundingClientRect();
        const centerX = rect.left + rect.width / 2;
        const centerY = rect.top + rect.height / 2;

        overlay.style.setProperty('--x', `${centerX}px`);
        overlay.style.setProperty('--y', `${centerY}px`);
        overlay.style.display = 'block';

        hintText.style.left = `${centerX}px`;
        hintText.style.top = `${centerY + 90}px`;
        hintText.style.display = 'block';

        setTimeout(() => {
          overlay.style.display = 'none';
          hintText.style.display = 'none';
        }, 10000); // –∏—Å—á–µ–∑–Ω–µ—Ç —á–µ—Ä–µ–∑ 10 —Å–µ–∫—É–Ω–¥
      }
    });



  </script>
</body>
</html>
